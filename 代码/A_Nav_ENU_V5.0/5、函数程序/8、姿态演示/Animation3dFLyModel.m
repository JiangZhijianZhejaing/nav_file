function Animation3dFLyModel(Eul_Set,multiple)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% function：姿态变化演示(仅适用100HZ)
%
% Prototype: animation3dFLyModel(Eul_Set)
% Inputs: Eul_Set - 欧拉角集
%         multiple - 快进倍数
%
% By Taoran Zhao
% 2023/04/29
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% ---------------一、导航系下飞机坐标---------------
% -----------148*3 三角连接矩阵----------
TR=[1 50 41;1 51 50;2 51 1;3 51 2;3 53 51;3 43 53;3 4 43;4 3 52;5 4 52;5 47 4;5 49 47;6 49 5;6 54 49;7 54 6;8 54 7;9 54 8;9 16 54;9 10 16;10 9 28;11 10 28;11 14 10;11 13 14;12 13 11;13 12 24;13 24 14;14 24 20;15 14 20;15 10 14;16 10 15;15 48 16;17 48 15;17 37 48;17 36 37;18 36 17;18 8 36;19 8 18;9 8 19;9 19 28;19 55 28;19 35 55;19 18 35;18 20 35;18 17 20;17 15 20;20 24 35;21 35 24;22 35 21;22 34 35;22 28 34;22 29 28;22 23 29;23 22 21;23 21 56;21 33 56;21 24 33;24 25 33;12 25 24;25 12 11;25 11 26;26 32 25;26 27 32;27 26 30;26 29 30;11 29 26;28 29 11;29 23 30;30 23 56;27 30 56;31 27 56;32 27 31;33 32 31;25 32 33;33 31 56;34 28 55;35 34 55;36 8 7;36 7 38;37 36 38;38 46 37;38 39 46;39 38 7;40 39 7;39 40 1;1 45 39;1 41 45;41 42 45;42 41 43;43 4 42;42 4 44;42 44 45;44 47 45;4 47 44;45 47 46;45 46 39;46 47 37;37 47 48;47 49 48;48 49 16;49 54 16;41 50 43;50 53 43;51 53 50;1 40 2;2 40 3;3 40 52;52 40 7;6 52 7;6 5 52;57 60 59;57 58 60;58 57 61;57 62 61;57 59 62;59 58 62;60 58 59;61 62 58;63 64 66;64 63 68;64 68 67;65 64 67;66 64 65;63 66 65;63 65 67;67 68 63;69 71 73;70 71 69;71 70 74;70 73 74;70 69 73;72 74 73;72 71 74;71 72 73;75 76 79;76 75 77;77 75 80;75 79 80;78 80 79;78 76 80;76 78 79;76 77 80;81 82 85;82 81 83;83 81 86;81 85 86;84 86 85;84 82 86;82 84 85;82 83 86];
% ----------86*3 三维坐标矩阵(表示86个点在三维空间中的坐标)----------
X=1.5*[0.4 0.025 -0.0433012701892219;
0.4 0.05 0;
0.4 0.025 0.0433012701892219;
0.4 -0.025 0.0433012701892219;
0.3 -0.035 0.0606217782649107;
0.2 0.035 0.0606217782649107;
0.2 0.07 0;
0 0.065 0;
-0.1 0.03 0.0519615242270663;
-0.1 -0.03 0.0519615242270663;
-0.2 -0.025 0.0433012701892219;
-0.3 -0.04 0;
-0.2 -0.05 0;
-0.1 -0.06 0;
0 -0.065 0;
0 -0.0325 0.0562916512459885;
0 -0.0325 -0.0562916512459885;
-0.1 0.03 -0.0519615242270663;
-0.1 0.06 0;
-0.1 -0.03 -0.0519615242270663;
-0.4 0.015 -0.0259807621135332;
-0.4 0.03 0;
-0.5 0.02 0;
-0.2 -0.025 -0.0433012701892219;
-0.4 -0.03 0;
-0.4 -0.015 0.0259807621135332;
-0.5 -0.01 0.0173205080756888;
-0.2 0.025 0.0433012701892219;
-0.4 0.015 0.0259807621135332;
-0.5 0.01 0.0173205080756888;
-0.5 -0.01 -0.0173205080756888;
-0.5 -0.02 0;
-0.4 -0.015 -0.0259807621135332;
-0.3 0.04 0;
-0.2 0.025 -0.0433012701892219;
0 0.0325 -0.0562916512459885;
0.2 -0.035 -0.0606217782649107;
0.2 0.035 -0.0606217782649107;
0.3 0.035 -0.0606217782649107;
0.3 0.07 0;
0.5 -0.01 -0.0173205080756888;
0.5 -0.02 0;
0.5 -0.01 0.0173205080756888;
0.4 -0.05 0;
0.4 -0.025 -0.0433012701892219;
0.3 -0.035 -0.0606217782649107;
0.3 -0.07 0;
0.2 -0.07 0;
0.2 -0.035 0.0606217782649107;
0.5 0.01 -0.0173205080756888;
0.5 0.02 0;
0.3 0.035 0.0606217782649107;
0.5 0.01 0.0173205080756888;
0 0.0325 0.0562916512459885;
-0.2 0.05 0;
-0.5 0.01 -0.0173205080756888;
0.2 0.0657784834550136 0.0239414100327968;
0 0.0562916512459885 -0.0325;
0.05 0.5 0;0.2 0.07 -0;
0 0.061080020351084 0.0222313093161685;
-0.05 0.5 0;
0 -0.0562916512459885 -0.0325;
0.2 -0.0657784834550136 0.0239414100327968;
0.05 -0.5 0;
0.2 -0.07 -0;
-0.05 -0.5 0;
0 -0.061080020351084 0.0222313093161685;
-0.45 0.2 0;
-0.4 0.0259807621135332 0.015;
-0.4 0.0259807621135332 -0.015;
-0.5 0.0173205080756888 -0.01;
-0.5 0.2 0;
-0.5 0.0173205080756888 0.01;
-0.4 -0.0259807621135332 0.015;
-0.4 -0.0259807621135332 -0.015;
-0.45 -0.2 0;
-0.5 -0.0173205080756888 -0.01;
-0.5 -0.0173205080756888 0.01;
-0.5 -0.2 0;
-0.4 0.012678547852221 0.0271892336110995;
-0.4 -0.012678547852221 0.0271892336110995;
-0.45 0 0.15;
-0.5 -0.00845236523481399 0.018126155740733;
-0.5 0.00845236523481399 0.018126155740733;
-0.5 0 0.15];
Xcnb = Eul2Cnb([0;0;-90]);
for kk = 1:86
    X_Init = X(kk,:);
    X_new = (Xcnb*X_Init')';
    X(kk,:) = X_new;  
end
len = size(Eul_Set,1);                                                            
step = 100*multiple;
newX = zeros(86,3);
for k = 1:step:len                            
    Cnb = Eul2Cnb(Eul_Set(k,:));
    for kk = 1:86
        X_Init = X(kk,:);
        X_new = (Cnb*X_Init')';
        newX(kk,:) = X_new;  
    end
    tiledlayout(3,40);
    nexttile([3 20])
    hold off;
    plot3([0,2],[0,0],[0,0],'m', ...
          [0,0],[0,2],[0,0],'m', ...
          [0,0],[0,0],[0,2], 'm'); % coordinate frame 
    set (gcf,'Position', [200 200 1500 750])  
    hold on; grid on    
    axis([-2 2 -2 2 -2 2]); 
    view([1 -1.2 1.1]);
    x = Cnb*[2;0;0];  y =  Cnb*[0;2;0];  z = Cnb*[0;0;2];
    plot3([0,x(1)],[0,x(2)],[0,x(3)],'-o', ...
          [0,y(1)],[0,y(2)],[0,y(3)],'-o', ...
          [0,z(1)],[0,z(2)],[0,z(3)],'-o', 'LineWidth', 3); % body frame
    view([1 -1.2 1.1]);
    hold on; grid on
    title('姿态变化演示'); 
    xlabel('X 西-东'); ylabel('Y 南-北'); zlabel('Z 地-天');
    trisurf(TR, newX(:,1),newX(:,2),newX(:,3), 'FaceColor','red','edgecolor','black');   
    view([1 -1.2 1.1]); 
    nexttile([1 20])
    plot((1:k)/100,Eul_Set(1:k,1)),title('俯仰角 Pitch'),xlabel('时间 t/s'),ylabel('角度 A/°'),legend('\theta');
    hold on; grid on 
    nexttile([1 20])
    plot((1:k)/100,Eul_Set(1:k,2)),title('横滚角 Roll '),xlabel('时间 t/s'),ylabel('角度 A/°'),legend('\gamma');hold on; grid on 
    nexttile([1 20])
    plot((1:k)/100,Eul_Set(1:k,3)),title('航向角 Yaw '),xlabel('时间 t/s'),ylabel('角度 A/°'),legend('\psi');hold on; grid on 
    hold on; grid on 
    pause(0.00000000000000000001);
end








